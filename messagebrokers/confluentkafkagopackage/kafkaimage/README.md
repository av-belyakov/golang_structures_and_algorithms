# Инструкция по запуску Kafka с SSL

### Генерация ключей:

```bash
./kafka-keygen.sh
```

Для того что бы проверить CA (Certificate Authority) выполняем

```bash
openssl s_client -connect localhost:9093 -CAfile ./certs/ca.crt </dev/null
```

так же можно посмотреть сертификат отдельно

```bash
openssl verify -CAfile ./certs/ca.crt ./certs/server.crt
```

посмотреть список допустимых IP-адресов для сертификата

```bash
openssl x509 -in ./certs/server.crt -text -noout | grep -A5 "Subject Alternative Name"
```

### Запуск docker-compose.ssl.yml

```bash
docker-compose -f docker-compose.ssl.yml up -d
```

Что бы проверить что Kafka слушает SSL порт

```bash
openssl s_client -connect localhost:9093 -showcerts </dev/null
``


#### Так на всякий случай

##### Аргументы утилиты keytool

Помните, что не все команды принимают все эти аргументы. Посмотрите на конкретную команду, чтобы увидеть, какие аргументы она принимает.

-alias Псевдоним записи в хранилище ключей. Помните, псевдоним
может указывать только на один ключ.
-keyalg Название алгоритма, используемого для генерации ключа. Обычно используется RSA.
-keysize Размер ключа в битах. Обычно размеры ключа кратны. Кроме того, различные алгоритмы могут поддерживать только определенные предварительно заданные размеры ключей.
-sigalg Алгоритм подписи, используемый для подписи пары ключей.
-dname Уникальное имя из стандарта X.500. Это имя будет связано с
псевдонимом для этой пары ключей в хранилище ключей, также
используется в качестве полей «эмитент» и «субъект» в самозаверяющем
сертификате.
-keypass Пароль ключевой пары, необходимый для
доступа к этой конкретной паре ключей в хранилище ключей.
-validity Количество дней, в течение которых сертификат,
приложенный к паре ключей, должен быть действительным.
-storetype Формат файла, в котором должно быть сохранено хранилище ключей. По умолчанию используется JKS. Другим вариантом является формат PKCS11.
-keystore Имя файла хранилища для хранения сгенерированной пары
ключей. Если файл не существует, он будет создан.
-file Имя файла для чтения или записи сертификата или запроса сертификата.
-storepass Пароль от хранилища ключей, всем, кто захочет работать
с ним, понадобится этот пароль. Отличие storepass от keypass в
том что первый предоставляет доступ к хранилищу, а второй к отдельной
паре ключей. Вам понадобятся оба пароля для доступа к любому ключу,
хранящемуся в хранилище.
-rfc Если включить этот флаг, то утилита будет использовать текстовый формат, а не двоичный формат, например для экспорта или импорта сертификатов. Значение -rfc
относится к стандарту RFC 1421.
-providerName Имя провайдера криптографического API, который вы хотите использовать при создании пары ключей. Имя провайдера должно быть указано в файлах свойств безопасности Java.
-providerClass Имя корневого класса провайдера криптографического API, который вы хотите использовать. Используется когда имя провайдера не указано в файлах свойств безопасности Java.
-providerArg Аргументы, передаваемые собственному криптографическому провайдеру при инициализации (если это необходимо провайдеру).
-v Сокращенное от verbose, утилита Keytool будет выводить много дополнительной информации в командную строку в удобочитаемом формате.
-protected Определяет, должен ли пароль хранилища ключей предоставляться каким-либо внешним механизмом, например, аппаратный токен. Допустимые значения: true и false.
-Jjavaoption Строка опций для Java VM которая генерирует пару ключей и создает хранилище.
```
